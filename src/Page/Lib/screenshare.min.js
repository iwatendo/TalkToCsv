/**
 * SkyWay-Screenshare-Library - Screenshare Library for SkyWay
 * @version v1.1.0
 * @author NTT Communications(skyway@ntt.com)
 * @link https://github.com/nttcom/SkyWay-ScreenShare
 * @license MIT License
 */
var SkyWay;!function(e){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var i=function(){function e(e){"undefined"==typeof e&&(e=null),this._debug=!1,null!==e&&"debug"in e&&(this._debug=e.debug)}return e.prototype.startScreenShare=function(e,i,t,a){var r=this;if("undefined"==typeof a&&(a=null),navigator.mozGetUserMedia){var n={video:{mozMediaSource:"window",mediaSource:"window"},audio:!1};isFinite(e.Width)&&(n.video.width={min:e.Width,max:e.Width}),isFinite(e.Height)&&(n.video.height={min:e.Height,max:e.Height}),isFinite(e.FrameRate)&&(n.video.frameRate={min:e.FrameRate,max:e.FrameRate}),this.logger("Parameter of getUserMedia : "+JSON.stringify(n)),navigator.mozGetUserMedia(n,function(e){i(e)},function(e){r.logger("Error message of getUserMedia : "+JSON.stringify(e)),t(e)})}else if(navigator.webkitGetUserMedia){var o={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:""},optional:[{googTemporalLayeredScreencast:!0}]};isFinite(e.Width)&&(o.mandatory.maxWidth=e.Width,o.mandatory.minWidth=e.Width),isFinite(e.Height)&&(o.mandatory.maxHeight=e.Height,o.mandatory.minHeight=e.Height),isFinite(e.FrameRate)&&(o.mandatory.maxFrameRate=e.FrameRate,o.mandatory.minFrameRate=e.FrameRate),window.addEventListener("message",function(e){r.logger('Received "'+e.data.type+'" message from Extension.'),"gotStreamId"==e.data.type&&(o.mandatory.chromeMediaSourceId=e.data.streamid,r.logger("Parameter of getUserMedia : "+JSON.stringify(o)),navigator.getUserMedia({audio:!1,video:o},function(e){r.logger("Got a stream for screen share");var t=e.getVideoTracks();t[0].onended=function(e){r.logger("Stream ended event fired : "+JSON.stringify(e)),"undefined"!=typeof a&&null!==a&&a()},i(e)},function(e){r.logger("Error message of getUserMedia : "+JSON.stringify(e)),t(e)}))}),window.postMessage({type:"getStreamId"},"*")}else if(window.AdapterJS&&AdapterJS.WebRTCPlugin&&AdapterJS.WebRTCPlugin.isPluginInstalled){var d={video:{optional:[{sourceId:AdapterJS.WebRTCPlugin.plugin.screensharingKey||"Screensharing"}]},audio:!1};AdapterJS.WebRTCPlugin.callWhenPluginReady(function(){if(!AdapterJS.WebRTCPlugin.plugin.HasScreensharingFeature||!AdapterJS.WebRTCPlugin.plugin.isScreensharingAvailable)throw new Error("Your WebRTC plugin does not support screensharing");navigator.getUserMedia(d,function(e){r.logger("Got a stream for screen share");var t=e.getVideoTracks();t[0].onended=function(e){r.logger("Stream ended event fired : "+JSON.stringify(e)),"undefined"!=typeof a&&a()},i(e)},function(e){r.logger("Error message of getUserMedia : "+JSON.stringify(e)),t(e)})})}},e.prototype.stopScreenShare=function(){return!1},e.prototype.isEnabledExtension=function(){return"boolean"==typeof window.ScreenShareExtentionExists||window.AdapterJS&&AdapterJS.WebRTCPlugin&&AdapterJS.WebRTCPlugin.isPluginInstalled?(this.logger("ScreenShare Extension available"),!0):(this.logger("ScreenShare Extension not available"),!1)},e.prototype.logger=function(e){this._debug&&console.log("SkyWay-ScreenShare: "+e)},e}();e.ScreenShare=i}(SkyWay||(SkyWay={}));